/*
 * Hasher
 * - History Manager for rich-media applications.
 * Includes: MM.EventDispatcher (0.7.2), MM.queryUtils (0.7)
 * @author Miller Medeiros <http://www.millermedeiros.com/>
 * @version 0.8.2 (2010/06/23)
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
var MM=MM||{};MM.EventDispatcher=function(){this._handlers={}};MM.EventDispatcher.prototype={addEventListener:function(a,b){if(typeof this._handlers[a]=="undefined"){this._handlers[a]=[]}this._handlers[a].push(b)},removeEventListener:function(b,c){if(!this.hasEventListener(b)){return}var a=this._handlers[b],d=a.length;if(d==1){delete this._handlers[b]}else{while(d--){if(a[d]==c){a.splice(d,1);break}}}},removeAllEventListeners:function(){this._handlers={}},hasEventListener:function(a){return(typeof this._handlers[a]!="undefined")},dispatchEvent:function(d){d=(typeof d=="string")?{type:d}:d;if(this.hasEventListener(d.type)){var a=this._handlers[d.type],c,b,f=a.length;d.target=d.target||this;for(b=0;b<f;b++){c=a[b];c(d)}}}};var MM=MM||{};MM.queryUtils={getQueryString:function(a){a=a||location.href;a=a.replace(/#[\w\W]*/,"");var b=/\?[a-zA-Z0-9\=\&\%\$\-\_\.\+\!\*\'\(\)\,]+/.exec(a);return(b)?decodeURIComponent(b[0]):""},getQueryObject:function(a){return this.toQueryObject(this.getQueryString(a))},toQueryObject:function(d){var a=d.replace("?","").split("&"),c=a.length,b={};while(c--){a[c]=a[c].split("=");b[a[c][0]]=a[c][1]}return b},getParamValue:function(b,a){return this.getQueryObject(a)[b]},hasParam:function(c,a){var b=new RegExp("(\\?|&)"+c+"=","g");return b.test(this.getQueryString(a))},toQueryString:function(b){var a=[],c;for(c in b){if(b.hasOwnProperty(c)){a.push(c+"="+b[c])}}return(a.length)?"?"+a.join("&"):""}};var HasherEvent=function(a,c,b){this.type=a;this.oldHash=c;this.newHash=b};HasherEvent.prototype.toString=function(){return'[HasherEvent type="'+this.type+'" oldHash="'+this.oldHash+'" newHash="'+this.newHash+'"]'};HasherEvent.CHANGE="change";HasherEvent.INIT="init";HasherEvent.STOP="stop";(function(i,k,d){var c=new MM.EventDispatcher(),g,m,f,e=/msie (6|7)/.test(navigator.userAgent.toLowerCase())&&(!+"\v1");function h(n){c.dispatchEvent(new HasherEvent(HasherEvent.CHANGE,g,n));g=n}function a(){f=k.createElement("iframe");f.src="about:blank";f.style.display="none";k.body.appendChild(f)}function b(){var n=f.contentWindow.document;n.open();n.write("<html><head><title>"+c.getTitle()+'</title><script type="text/javascript">var frameHash="'+c.getHash()+'";<\/script></head><body>&nbsp;</body></html>');n.close()}function l(){var n=c.getHash();if(n!=g){h(n)}}function j(){var o=c.getHash(),n=f.contentWindow.frameHash;if(n!=o&&n!=g){c.setHash(n);h(n)}else{if(o!=g){if(n!=o){b()}h(o)}}}this.Hasher=c;c.init=function(){var n=this.getHash();if(e){if(!f){a();b()}m=setInterval(j,25)}else{m=setInterval(l,25)}this.dispatchEvent(new HasherEvent(HasherEvent.INIT,g,n));g=n};c.stop=function(){clearInterval(m);m=null;this.dispatchEvent(new HasherEvent(HasherEvent.STOP,g,g))};c.setHash=function(n){location.hash=n};c.getHash=function(){return location.hash.substr(1)};c.getHashAsArray=function(p){p=p||"/";var o=this.getHash(),n=new RegExp("^\\"+p+"|\\"+p+"$","g");o=o.replace(n,"");return o.split(p)};c.getURL=function(){return location.href};c.getBaseURL=function(){return location.href.replace(/(\?.*)|(\#.*)/,"")};c.setTitle=function(n){k.title=n};c.getTitle=function(){return k.title};c.back=function(){history.back()};c.forward=function(){history.forward()};c.go=function(n){history.go(n)};c.getHashQuery=function(){return MM.queryUtils.getQueryString(this.getHash())};c.getHashQueryAsObject=function(){return MM.queryUtils.toQueryObject(this.getHashQuery())};c.getHashQueryParam=function(n){return MM.queryUtils.getParamValue(n,this.getHash())}}(window,document));
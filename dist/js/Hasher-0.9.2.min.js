/*
 * Hasher <http://github.com/millermedeiros/Hasher>
 * Includes: MM.EventDispatcher (0.7.2), MM.queryUtils (0.7), MM.event-listenerFacade (0.3)
 * @author Miller Medeiros <http://www.millermedeiros.com/>
 * @version 0.9.2 (2010/07/08)
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
var MM=MM||{};MM.EventDispatcher=function(){this._handlers={}};MM.EventDispatcher.prototype={addEventListener:function(a,b){if(typeof this._handlers[a]=="undefined"){this._handlers[a]=[]}this._handlers[a].push(b)},removeEventListener:function(b,c){if(!this.hasEventListener(b)){return}var a=this._handlers[b],d=a.length;if(d==1){delete this._handlers[b]}else{while(d--){if(a[d]==c){a.splice(d,1);break}}}},removeAllEventListeners:function(){this._handlers={}},hasEventListener:function(a){return(typeof this._handlers[a]!="undefined")},dispatchEvent:function(d){d=(typeof d=="string")?{type:d}:d;if(this.hasEventListener(d.type)){var a=this._handlers[d.type],c,b,f=a.length;d.target=d.target||this;for(b=0;b<f;b++){c=a[b];c(d)}}}};var MM=MM||{};MM.queryUtils={getQueryString:function(a){a=a||location.href;a=a.replace(/#[\w\W]*/,"");var b=/\?[a-zA-Z0-9\=\&\%\$\-\_\.\+\!\*\'\(\)\,]+/.exec(a);return(b)?decodeURIComponent(b[0]):""},getQueryObject:function(a){return this.toQueryObject(this.getQueryString(a))},toQueryObject:function(d){var a=d.replace("?","").split("&"),c=a.length,b={};while(c--){a[c]=a[c].split("=");b[a[c][0]]=a[c][1]}return b},getParamValue:function(b,a){return this.getQueryObject(a)[b]},hasParam:function(c,a){var b=new RegExp("(\\?|&)"+c+"=","g");return b.test(this.getQueryString(a))},toQueryString:function(b){var a=[],c;for(c in b){if(b.hasOwnProperty(c)){a.push(c+"="+b[c])}}return(a.length)?"?"+a.join("&"):""}};var MM=MM||{};MM.event=MM.event||{};MM.event.addListener=function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false)}else{if(c.attachEvent){c.attachEvent("on"+a,b)}else{c["on"+a]=b}}};MM.event.removeListener=function(c,a,b){if(c.removeEventListener){c.removeEventListener(a,b,false)}else{if(c.detachEvent){c.detachEvent("on"+a,b)}else{c["on"+a]=null}}};var HasherEvent=function(a,c,b){this.type=a;this.oldHash=c;this.newHash=b};HasherEvent.prototype.toString=function(){return'[HasherEvent type="'+this.type+'" oldHash="'+this.oldHash+'" newHash="'+this.newHash+'"]'};HasherEvent.CHANGE="change";HasherEvent.INIT="init";HasherEvent.STOP="stop";(function(k,m,f){var d=new MM.EventDispatcher(),h,o,i,g,e=/MSIE (6|7)/.test(navigator.userAgent)&&(!+"\v1"),b=("onhashchange" in k);function j(p){if(i&&h!=p){d.dispatchEvent(new HasherEvent(HasherEvent.CHANGE,h,p));h=p}}function a(){g=m.createElement("iframe");g.src="about:blank";g.style.display="none";m.body.appendChild(g)}function c(){var p=g.contentWindow.document;p.open();p.write("<html><head><title>"+d.getTitle()+'</title><script type="text/javascript">var frameHash="'+d.getHash()+'";<\/script></head><body>&nbsp;</body></html>');p.close()}function n(){var p=d.getHash();if(p!=h){j(p)}}function l(){var q=d.getHash(),p=g.contentWindow.frameHash;if(p!=q&&p!=h){d.setHash(p);j(p)}else{if(q!=h){if(p!=q){c()}j(q)}}}this.Hasher=d;d.init=function(){if(i){return}var p=this.getHash();if(b){MM.event.removeListener(k,"hashchange",n);MM.event.addListener(k,"hashchange",n)}else{clearInterval(o);if(e){if(!g){a();c()}o=setInterval(l,25)}else{o=setInterval(n,25)}}i=true;this.dispatchEvent(new HasherEvent(HasherEvent.INIT,h,p));h=p};d.stop=function(){if(!i){return}if(b){MM.event.removeListener(k,"hashchange",n)}else{clearInterval(o);o=null}this.dispatchEvent(new HasherEvent(HasherEvent.STOP,h,h))};d.getURL=function(){return location.href};d.getBaseURL=function(){return location.href.replace(/(\?.*)|(\#.*)/,"")};d.setHash=function(p){location.hash=p;j(p)};d.getHash=function(){var p=/#(.*)$/.exec(this.getURL());return(p&&p[1])?decodeURIComponent(p[1]):""};d.getHashAsArray=function(r){r=r||"/";var q=this.getHash(),p=new RegExp("^\\"+r+"|\\"+r+"$","g");q=q.replace(p,"");return q.split(r)};d.getHashQuery=function(){return MM.queryUtils.getQueryString(this.getHash()).substr(1)};d.getHashQueryAsObject=function(){return MM.queryUtils.toQueryObject(this.getHashQuery())};d.getHashQueryParam=function(p){return MM.queryUtils.getParamValue(p,this.getHash())};d.setTitle=function(p){m.title=p};d.getTitle=function(){return m.title};d.back=function(){history.back()};d.forward=function(){history.forward()};d.go=function(p){history.go(p)}}(window,document));
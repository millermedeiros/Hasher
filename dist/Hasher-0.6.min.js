/*
 * Hasher
 * - History Manager for rich-media applications.
 * @author Miller Medeiros <http://www.millermedeiros.com/>
 * @version 0.6 (2010/05/10)
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 *
 * Includes: MM.EventDispatcher (0.7), MM.queryUtils (0.3)
 * @author Miller Medeiros <http://www.millermedeiros.com/>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
this.MM=this.MM||{};MM.EventDispatcher=function(){this._handlers={}};MM.EventDispatcher.prototype={addEventListener:function(a,b){if(typeof this._handlers[a]=="undefined"){this._handlers[a]=[]}this._handlers[a].push(b)},removeEventListener:function(b,c){if(!this.hasEventListener(b)){return}var a=this._handlers[b],d=a.length;if(d==1){delete this._handlers[b]}else{while(d--){if(a[d]==c){a.splice(d,1);break}}}},removeAllEventListeners:function(){this._handlers={}},hasEventListener:function(a){return(typeof this._handlers[a]!="undefined")},dispatchEvent:function(d){d=(typeof d=="string")?{type:d}:d;if(this.hasEventListener(d.type)){var a=this._handlers[d.type],c,b,f=a.length;d.target=d.target||this;for(b=0;b<f;b++){c=a[b];c(d)}}}};this.MM=this.MM||{};MM.queryUtils={getQueryString:function(){return decodeURIComponent(location.search.substring(1))},getQueryObject:function(){var a=this.getQueryString().split("&"),c=a.length,b={};while(c--){a[c]=a[c].split("=");b[a[c][0]]=a[c][1]}return b},getParamValue:function(a){return this.getQueryObject()[a]},hasParam:function(a){return(this.getQueryString().indexOf(a+"=")>=0)},toQueryString:function(b){var a=[],c;for(c in b){a.push(c+"="+b[c])}return(a.length)?"?"+a.join("&"):""}};(function(){var i=window.location,e,j,d,c=/msie (6|7)/.test(navigator.userAgent.toLowerCase())&&!+"\v1";this.Hasher=new MM.EventDispatcher();Hasher.init=function(){var k=Hasher.getHash();if(c){if(!d){a();b()}j=setInterval(g,25)}else{j=setInterval(h,25)}this.dispatchEvent(new HasherEvent(HasherEvent.INIT,e,k));e=k};Hasher.stop=function(){clearInterval(j);j=null;this.dispatchEvent(new HasherEvent(HasherEvent.STOP,e,e))};Hasher.setHash=function(k){i.hash=k};Hasher.getHash=function(){return i.hash.substr(1)};Hasher.getHashAsArray=function(k){k=k||"/";return Hasher.getHash().split(k)};Hasher.replaceLocation=function(k){i.replace(k)};Hasher.getURL=function(){return i.href};Hasher.getBaseURL=function(){return i.href.replace(/(\?.*)|(\#.+)/,"")};Hasher.getHostName=function(){return i.hostname};Hasher.getPathName=function(){return i.pathname};Hasher.setTitle=function(k){document.title=k};Hasher.getTitle=function(){return document.title};Hasher.back=function(){history.back()};Hasher.forward=function(){history.forward()};Hasher.go=function(k){history.go(k)};Hasher.getHistoryLength=function(){return history.length};Hasher.getQueryString=MM.queryUtils.getQueryString;Hasher.getQueryObject=MM.queryUtils.getQueryObject;Hasher.getParamValue=MM.queryUtils.getParamValue;Hasher.hasParam=MM.queryUtils.hasParam;Hasher.toQueryString=MM.queryUtils.toQueryString;function f(k){Hasher.dispatchEvent(new HasherEvent(HasherEvent.CHANGE,e,k));e=k}function h(){var k=Hasher.getHash();if(k!=e){f(k)}}function g(){var l=Hasher.getHash(),k=d.contentWindow.frameHash;if(k!=l&&k!=e){Hasher.setTitle(d.contentWindow.document.title);Hasher.setHash(k);f(k)}else{if(l!=e){if(k!=l){b()}f(l)}}}function a(){d=document.createElement("iframe");d.src="javascript:false";d.style.display="none";document.body.appendChild(d)}function b(){var k=d.contentWindow.document;k.open();k.write("<html><head><title>"+Hasher.getTitle()+'</title><script type="text/javascript">var frameHash="'+Hasher.getHash()+'";<\/script></head><body>&nbsp;</body></html>');k.close()}})();var HasherEvent=function(a,c,b){this.type=a;this.oldHash=c;this.newHash=b};HasherEvent.prototype.toString=function(){return'[HasherEvent type="'+this.type+'" oldHash="'+this.oldHash+'" newHash="'+this.newHash+'"]'};HasherEvent.CHANGE="change";HasherEvent.INIT="init";HasherEvent.STOP="stop";